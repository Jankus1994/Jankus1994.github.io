<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>Domination Game - Admin</title>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<style>
body {
  font-family: Arial, sans-serif;
  max-width: 600px;
  margin: 40px auto;
  padding: 20px;
  background: #f9f9f9;
  border-radius: 12px;
  box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}
h1 {
  text-align: center;
  color: #333;
}
div {
  margin-bottom: 15px;
}
label {
  font-weight: bold;
  margin-right: 10px;
}
input[type="number"] {
  width: 60px;
  padding: 5px;
  border-radius: 5px;
  border: 1px solid #ccc;
}
button {
  margin-right: 10px;
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  background-color: #007bff;
  color: white;
  font-weight: bold;
  cursor: pointer;
}
button:hover {
  background-color: #0056b3;
}
#gameStatus {
  font-weight: bold;
  font-size: 1.2em;
  margin-bottom: 20px;
}
</style>
</head>
<body>
<h1>Admin - Domination Game</h1>

<p>Aktuální stav hry: <span id="gameStatus">načítám...</span></p>

<div>
  <label for="dividerInput">Dělitel pro bodování:</label>
  <input type="number" id="dividerInput" value="1" min="1">
</div>

<button id="startBtn">Spustit hru</button>
<button id="stopBtn">Zastavit hru</button>
<button id="resetBtn">Reset skóre a stanovišť</button>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDOEonHWXYZU5bYuETpI_6bk7oIVyHQP1Q",
    authDomain: "domination-game-c1426.firebaseapp.com",
    projectId: "domination-game-c1426",
    storageBucket: "domination-game-c1426.firebasestorage.app",
    messagingSenderId: "630646319",
    appId: "1:630646319:web:8ef916ac9c10ca071a48da"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const dividerInput = document.getElementById("dividerInput");
  const startBtn = document.getElementById("startBtn");
  const stopBtn = document.getElementById("stopBtn");
  const resetBtn = document.getElementById("resetBtn");
  const gameStatusSpan = document.getElementById("gameStatus");

  // Listener pro aktuální stav hry
  db.collection("game").doc("state").onSnapshot(doc => {
    const data = doc.data();
    if(data) {
      gameStatusSpan.textContent = data.status || "neznámý";
      dividerInput.value = data.divider || 1;
    }
  });

  startBtn.addEventListener("click", async () => {
    await db.collection("game").doc("state").set({
      status: "running",
      divider: parseInt(dividerInput.value) || 1
    }, { merge: true });
    console.log("Hra spuštěna");
  });

  stopBtn.addEventListener("click", async () => {
    await db.collection("game").doc("state").set({
      status: "stopped"
    }, { merge: true });
    console.log("Hra zastavena");
  });

  resetBtn.addEventListener("click", async () => {
    await db.collection("scores").doc("teams").set({ A:0, B:0 });
    const locs = await db.collection("locations").get();
    locs.forEach(async doc => {
      await db.collection("locations").doc(doc.id).set({ owner: "neutral" }, { merge: true });
    });
    await db.collection("game").doc("state").set({
      status: "stopped",
      divider: parseInt(dividerInput.value) || 1
    }, { merge: true });
    console.log("Hra resetována");
  });
</script>
</body>
</html>
