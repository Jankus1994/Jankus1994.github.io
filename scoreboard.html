<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <title>Scoreboard</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js"></script>
</head>
<body>
  <div class="container">
    <h1>Domination Game – Scoreboard</h1>

    <div class="card">
      <h2>Skóre</h2>
      <p>Tým A: <span id="scoreA">0</span></p>
      <p>Tým B: <span id="scoreB">0</span></p>
      <p>Hra: <span id="gameStatus">Načítám…</span></p>
    </div>

    <div class="card">
      <h2>Control Points</h2>
      <ul id="locationsList"></ul>
    </div>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDOEonHWXYZU5bYuETpI_6bk7oIVyHQP1Q",
      authDomain: "domination-game-c1426.firebaseapp.com",
      projectId: "domination-game-c1426",
      storageBucket: "domination-game-c1426.firebasestorage.app",
      messagingSenderId: "630646319",
      appId: "1:630646319:web:8ef916ac9c10ca071a48da"
    };

    const app = firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // skóre
    db.collection("scores").doc("teams").onSnapshot(doc => {
      if (doc.exists) {
        const scores = doc.data();
        db.collection("game").doc("state").get().then(stateDoc => {
          const divider = stateDoc.exists ? (stateDoc.data().divider ?? 1) : 1;
          document.getElementById("scoreA").innerText = (scores.A / divider).toFixed(1);
          document.getElementById("scoreB").innerText = (scores.B / divider).toFixed(1);
        });
      }
    });

    // stav hry
    db.collection("game").doc("state").onSnapshot(doc => {
      if (doc.exists) {
        const state = doc.data();
        const statusText = state.status === "running" ? "Spuštěná" : "Zastavená";
        document.getElementById("gameStatus").innerText = `${statusText} (dělitel: ${state.divider ?? 1})`;
      }
    });

    // stanoviště
    db.collection("locations").onSnapshot(snapshot => {
      const list = document.getElementById("locationsList");
      list.innerHTML = "";
      snapshot.forEach(doc => {
        const li = document.createElement("li");
        li.innerText = `${doc.id}: ${doc.data().owner}`;
        list.appendChild(li);
      });
    });
  </script>
</body>
</html>
