<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Scoreboard - Domination Game</title>
<link rel="stylesheet" href="style.css">
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container">
<h1>Scoreboard</h1>
<div>Hra: <span id="gameStatus">Načítám…</span></div>
<div>Score A: <span id="scoreA">0</span> | Score B: <span id="scoreB">0</span></div>

<table class="table">
<thead><tr><th>Control Point</th><th>Vlastník</th></tr></thead>
<tbody id="locationsTable"></tbody>
</table>
</div>

<script>
const firebaseConfig = {
      apiKey: "AIzaSyDOEonHWXYZU5bYuETpI_6bk7oIVyHQP1Q",
      authDomain: "domination-game-c1426.firebaseapp.com",
      projectId: "domination-game-c1426",
      storageBucket: "domination-game-c1426.firebasestorage.app",
      messagingSenderId: "630646319",
      appId: "1:630646319:web:8ef916ac9c10ca071a48da"  
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

let gameStatus="stopped", divider=1;
const statusEl = document.getElementById("gameStatus");
const scoreAEl = document.getElementById("scoreA");
const scoreBEl = document.getElementById("scoreB");
const tableEl = document.getElementById("locationsTable");

db.collection("game").doc("state").onSnapshot(doc=>{
  if(doc.exists){ 
    gameStatus = doc.data().status;
    divider = doc.data().divider || 1;
    statusEl.textContent = gameStatus;
  }
});

db.collection("scores").doc("teams").onSnapshot(doc=>{
  if(doc.exists){
    scoreAEl.textContent = doc.data().A.toFixed(1);
    scoreBEl.textContent = doc.data().B.toFixed(1);
  }
});

function refreshLocations(){
  db.collection("locations").get().then(snap=>{
    tableEl.innerHTML="";
    snap.forEach(doc=>{
      const row = document.createElement("tr");
      row.innerHTML=`<td>${doc.id}</td><td>${doc.data().owner}</td>`;
      tableEl.appendChild(row);
    });
  });
}

refreshLocations();
db.collection("locations").onSnapshot(refreshLocations);

// interval pro přičítání bodů
setInterval(()=>{
  if(gameStatus!=="running") return;
  db.collection("locations").get().then(snap=>{
    let addA=0, addB=0;
    snap.forEach(doc=>{
      if(doc.data().owner==="A") addA+=1/divider;
      else if(doc.data().owner==="B") addB+=1/divider;
    });
    db.collection("scores").doc("teams").set({ A:firebase.firestore.FieldValue.increment(addA), B:firebase.firestore.FieldValue.increment(addB) }, { merge:true });
  });
},1000);
</script>
</body>
</html>
